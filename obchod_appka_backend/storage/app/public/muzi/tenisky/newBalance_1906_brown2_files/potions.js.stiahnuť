(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{getNode:()=>getNode,insertHTML:()=>insertHTML});var n={};e.r(n),e.d(n,{descendingInJson:()=>descendingInJson,formatDate:()=>formatDate,formatPrice:()=>formatPrice,getDomain:()=>getDomain,isPotionsProductObject:()=>isPotionsProductObject,parseQueryString:()=>parseQueryString,parseStringToNumber:()=>parseStringToNumber,stringifyQueryString:()=>stringifyQueryString,uuidv4:()=>uuidv4});var i={};e.r(i),e.d(i,{getAnalyticsInfos:()=>getAnalyticsInfos});class DBWrapper{constructor(e,t,n){this._db=null,this._version=t,this._name=e,this._objectStoreConfiguration=n}async open(){if(!this._db)try{this._db=await new Promise(((e,t)=>{const n=indexedDB.open(this._name,this._version);n.addEventListener("error",(()=>t(n.error))),n.onupgradeneeded=e=>{const t=e.target.result,n=e.target.transaction;this._objectStoreConfiguration.forEach((e=>{if(t.objectStoreNames.contains(e.name)){const t=n?.objectStore(e.name);e?.indexes?.forEach((e=>{t&&!t.indexNames.contains(e)&&t.createIndex(e,e,{unique:!1})}))}else{const n=t.createObjectStore(e.name,e.options);e?.indexes?.forEach((e=>{n.createIndex(e,e,{unique:!1})}))}}))},n.onsuccess=t=>{e(t.target.result)}}))}catch(e){window.potions.logger.captureError(e,!1)}}async getAll(e){return window.indexedDB?(await this.open(),this._db?new Promise(((t,n)=>{try{if(!this._db)return[];const n=this._db.transaction(e,"readonly"),i=n.objectStore(e).openCursor(),s=[];i.onsuccess=e=>{const n=e.target.result;n?(s.push(n.value),n.continue()):t(s)},i.addEventListener("error",(()=>{window.potions.logger.captureError(i.error,!1)}))}catch(e){window.potions.logger.captureError(e,!1),t([])}})):[]):[]}async getAllByIndex(e,t,n){return window.indexedDB?(await this.open(),this._db?new Promise(((i,s)=>{try{if(!this._db)return[];const s=this._db.transaction(e,"readonly").objectStore(e),o=s.index(t).getAll(n);o.onsuccess=()=>{i(o.result)}}catch(e){window.potions.logger.captureError(e,!1),i([])}})):[]):[]}async get(e,t){return window.indexedDB?(await this.open(),this._db?new Promise(((n,i)=>{try{if(!this._db)return{};const i=this._db.transaction(e,"readonly"),s=i.objectStore(e).get(t);s.onsuccess=()=>{n(s.result)}}catch(e){window.potions.logger.captureError(e,!1),n({})}})):{}):{}}async add(e,t){if(window.indexedDB)return await this.open(),this._db?new Promise(((n,i)=>{try{if(!this._db)return{};const i=this._db.transaction(e,"readwrite"),s=i.objectStore(e).add(t);s.onsuccess=()=>{n(s.result)}}catch(e){window.potions.logger.captureError(e,!1),n("")}})):{}}async update(e,t,n){return window.indexedDB?(await this.open(),this._db?new Promise(((i,s)=>{try{if(!this._db)return;const s=this._db.transaction(e,"readwrite"),o=s.objectStore(e).put(t,n);o.onsuccess=()=>{i(o.result)}}catch(e){window.potions.logger.captureError(e,!1),i("")}})):void 0):{}}async query(e,t,n){return window.indexedDB?(await this.open(),this._db?new Promise(((i,s)=>{try{const s=DBWrapper.createRange(t);if(!this._db)return[];const o=this._db.transaction(e,"readwrite").objectStore(e);let r=o.openCursor(s);if(n){const e=o.index(n);r=e.openCursor(s)}const a=[];r.onsuccess=()=>{const e=r.result;e?(a.push({index:e.key,value:e.value}),e.continue()):i(a)}}catch(e){window.potions.logger.captureError(e,!1),i([])}})):[]):[]}static createRange(e){return e.min&&e.max?IDBKeyRange.bound(e.min,e.max):e.min&&!e.max?IDBKeyRange.lowerBound(e.min):e.max&&!e.min?IDBKeyRange.upperBound(e.max):IDBKeyRange.only(e.equal)}async delete(e,t){return window.indexedDB?(await this.open(),this._db?new Promise(((n,i)=>{try{if(!this._db)return{};const i=this._db.transaction(e,"readwrite"),s=i.objectStore(e).delete(t);s.onsuccess=()=>{n(s.result)}}catch(e){window.potions.logger.captureError(e,!1),n("")}})):{}):""}async clear(e){return window.indexedDB?(await this.open(),this._db?new Promise(((t,n)=>{try{if(!this._db)return{};const n=this._db.transaction(e,"readwrite"),i=n.objectStore(e).clear();i.onsuccess=()=>{t(i.result)}}catch(e){window.potions.logger.captureError(e,!1),t("")}})):{}):""}close(){this._db&&(this._db.close(),this._db=null)}}class Resource{constructor(e){this._url=`https://client.get-potions.com${e}`,this._db=new DBWrapper("potions_resources",1,[{name:"resources",options:{keyPath:"name"},indexes:[]}]),this._resource={}}get url(){return this._url}async get(){return this.isUpdateNeeded(this._resource)&&await this.update(),this._resource}async getData(){return this.isUpdateNeeded(this._resource)&&await this.update(),this._resource.data}async fetchServer(){return new Promise((e=>{fetch(this._url).then((t=>{t.ok?e(t.clone().json().catch((()=>t.text()))):e({})})).catch((t=>{window.potions.logger.captureError(t,!1),e({})}))}))}async update(){const e=await(this._db?.get("resources",this._url));if(void 0===e||this.isUpdateNeeded(e)){const e=await this.fetchServer();this.set(e)}else this._resource=e}async set(e){this._resource={name:this._url,data:e,last_update:Date.now(),version:"14.4.1"},this._db?.update("resources",this._resource),window.dispatchEvent(new CustomEvent("potions_update_resource",{detail:this._resource}))}isUpdateNeeded(e){return!(!e||"14.4.1"===e.version)||(!e||!e.last_update||Date.now()-e.last_update>18e5)}}class Widget{constructor(e,t,n=[],i={}){this._resources={},this._potions=e,this._name=t,this._processes={},this._storage={},this._listeners={},this._actions={},this._elements=[],this.buildResources(i.resources??n),this.buildCustom(i)}get name(){return this._name}get resources(){return this._resources}get processes(){return this._processes}get listeners(){return this._listeners}get storage(){return this._storage}get actions(){return this._actions}get elements(){return this._elements}buildResources(e){e.forEach((e=>{const t=e.name;this._resources[t]=e.type.fromResource(new Resource(`/resources/footshop/${this._name}/${e.file}`).getData(),t)}))}buildCustom(e){for(const[t,n]of Object.entries(e??{})){if("resources"===t)continue;"elements"===t&&(this._elements=n);const e=t.split(".");let i=this;for(const t of e)if(i=i[t],void 0===t)return;for(const[e,t]of Object.entries(n))i[e]=t}}}class EventObserver{constructor(e){this._executor=e}observe(e,t){window.addEventListener(t,(t=>{try{this._executor(t,e)}catch(e){window.potions.logger.captureError(e)}}))}disconnect(e){window.removeEventListener(e,this._executor,!1)}}class Process{constructor(e,t,n){this._executor=e,this._trigger=t,this._ruleResource=n}launch(e){"string"==typeof this._trigger?this.startObserver(e,this._trigger):this._trigger.forEach((t=>{this.startObserver(e,t,(()=>{if("string"!=typeof this._trigger){let t=!0;return this._trigger.forEach((n=>{t=t&&e[n]})),t}}))}))}async startObserver(e,t,n=(()=>!0)){this._ruleResource?this._observer=new EventObserver((async(e,t)=>{if(n(e)){const n=await(this._ruleResource?.rules);if(await(n[this._ruleResource?.rule_name]?.apply()))try{this._executor(e,t)}catch(e){window.potions.logger.captureError(e)}}})):this._observer=new EventObserver((t=>{if(n(t))try{this._executor(t,e)}catch(e){window.potions.logger.captureError(e)}})),this._observer.observe(e,t)}}class State{constructor(){this._domLoaded=!1,this._scrolled=!1,this._active=!1,this._pageId=0,this._sessionId=0,this._lastSessionId=0,this._urlsInSession=[],this._nbPageInSession=0,this._timeInPage=0,this._timeInSession=0,this._lastUrlView={},this._timeLastScroll=Date.now(),this._sessionSinceLastTransaction=0,this._geoLoc="",this._device="ontouchstart"in window||navigator.maxTouchPoints?"mobile":"desktop",window.addEventListener("scroll",(()=>{this._timeLastScroll=Date.now()}))}get device(){return this._device}get geoLoc(){return this._geoLoc}set geoLoc(e){e!==this._geoLoc&&(this._geoLoc=e,State.stateHasChanged("geoLoc",e))}get domLoaded(){return this._domLoaded}set domLoaded(e){e!==this._domLoaded&&(this._domLoaded=e,State.stateHasChanged("domLoaded",e))}get scrolled(){return this._scrolled}set scrolled(e){e!==this._scrolled&&(this._scrolled=e,State.stateHasChanged("scrolled",e))}get active(){return this._active}set active(e){e!==this._active&&(this._active=e,State.stateHasChanged("active",e))}get pageId(){return this._pageId}async setPageId(e,t){e!==this._pageId&&(this._pageId=e,await this.update(t),this.timer(),State.stateHasChanged("pageId",e))}get sessionId(){return this._sessionId}get lastSessionId(){return this._lastSessionId}setSessionId(e){e!==this._sessionId&&(this._sessionId=e,this._lastSessionId=e-1>0?e-1:1,State.stateHasChanged("sessionId",e))}get nbPageInSession(){return this._nbPageInSession}get timeInSession(){return this._timeInSession}get timeInPage(){return this._timeInPage}get urlsInSession(){return this._urlsInSession}get lastUrlView(){return this._lastUrlView}get sessionSinceLastTransaction(){return this._sessionSinceLastTransaction}get timeWithoutScroll(){return Date.now()-this._timeLastScroll}static stateHasChanged(e,t){window.dispatchEvent(new CustomEvent(e,{detail:{value:t}}))}timer(){setInterval((()=>{this._timeInSession+=2e3,this._timeInPage+=2e3,State.stateHasChanged("timer",this._timeInSession)}),2e3)}async update(e){try{await this.updateLastPageTime(e,this._pageId);const t=await e.widgets.navigation_recorder.storage.db.query("visited_urls",{equal:this._sessionId},"session_id");this._urlsInSession=t.map((e=>e.value.url)),this._nbPageInSession=t.length,this._timeInSession=t.map((e=>e.value.departure_timestamp?e.value.departure_timestamp-e.value.arrival_timestamp:Date.now()-e.value.arrival_timestamp)).reduce(((e,t)=>e+t),0);const n=await e.widgets.navigation_recorder.storage.db.getAll("sessions"),i=n.filter((e=>e.transaction))?.pop();this._sessionSinceLastTransaction=i?this._sessionId-i.id:this._sessionId,this._geoLoc=n.pop().geo_loc||""}catch(e){window.potions.logger.captureError(e)}}async updateLastPageTime(e,t){if(t-1>0){const n=await e.widgets.navigation_recorder.storage.db.get("visited_urls",t-1);if(Date.now()-n.arrival_timestamp>18e5){const t=await e.widgets.navigation_recorder.storage.db.query("visited_urls",{equal:this._sessionId-1},"session_id");n.departure_timestamp=t.map((e=>e.value.departure_timestamp-e.value.arrival_timestamp)).reduce(((e,t)=>e+t),0)/t.length}else n.departure_timestamp=Date.now();this._lastUrlView=n,await e.widgets.navigation_recorder.storage.db.update("visited_urls",n)}}}class Listener{constructor(e){this._options=e,this._potions=window.potions}get options(){return this._options}}class EventListener extends Listener{launch(e){this._method=async t=>{try{await this._options.executor(t,e)}catch(e){window.potions.logger.captureError(e)}},this._options.event_name&&window.addEventListener(this._options.event_name,this._method,!0)}disconnect(){this._options.event_name&&window.removeEventListener(this._options.event_name,this._method)}}class FunctionListener extends Listener{async launch(e){try{await this._options.executor(new CustomEvent(""),e)}catch(e){window.potions.logger.captureError(e)}}}const s={dom_loaded:new EventListener({event_name:"DOMContentLoaded",executor:(e,t)=>{t.domLoaded=!0}}),dom_already_loaded:new FunctionListener({executor:(e,t)=>{"interactive"!==document.readyState&&"complete"!==document.readyState||(t.domLoaded=!0)}}),scroll:new EventListener({event_name:"scroll",executor:(e,t)=>{0!==window.scrollY&&(t.scrolled=!0)}}),click:new EventListener({event_name:"click",executor:(e,t)=>{t.active=!0}}),keyup:new EventListener({event_name:"keyup",executor:e=>{window.dispatchEvent(new CustomEvent("potions_input_change",{detail:{type:"keyup",native_event:e}}))}}),change:new EventListener({event_name:"change",executor:e=>{window.dispatchEvent(new CustomEvent("potions_input_change",{detail:{type:"change",native_event:e}}))}}),mouse_out:new EventListener({event_name:"mouseout",executor:e=>{e&&null===e.relatedTarget&&(e.clientX<=0||e.clientX>=window.innerWidth||e.clientY<=0||e.clientY>=window.innerHeight)&&setTimeout((()=>{window.dispatchEvent(new CustomEvent("potions_leaving_page"))}),500)}}),close_page:new EventListener({event_name:"beforeunload",executor:e=>{window.dispatchEvent(new CustomEvent("potions_close_page",{detail:{type:"change",native_event:e}}))}})};function updateListenersPotions(e){[...document.querySelectorAll("potions_propulse")].forEach((e=>e.remove())),[...document.querySelectorAll("potions-flashback")].forEach((e=>e.remove())),window.dispatchEvent(new CustomEvent("potions_url_change",{detail:{url:e}})),function reloadPropulseListeners(){setTimeout((()=>{window.potions.widgets.propulse?.listeners&&Object.values(window.potions.widgets.propulse?.listeners).forEach((e=>{e.options.query_selector&&e.launch(window.potions.state)}))}),200)}()}const o={push_state:new FunctionListener({executor:()=>{const e=history.pushState;history.pushState=(t,n,i)=>{e.apply(history,[t,n,i]),window.dispatchEvent(new CustomEvent("potions_url_change",{detail:{url:i}}))}}}),replace_state:new FunctionListener({executor:()=>{const e=history.replaceState;history.replaceState=(t,n,i)=>{e.apply(history,[t,n,i]),window.dispatchEvent(new CustomEvent("potions_url_change",{detail:{url:i}}))}}}),new_script_loaded:new FunctionListener({executor:()=>{window.dispatchEvent(new CustomEvent("potions_url_change",{detail:{url:window.location.href}}))}})};({sentry:!1,analytics:[],multiply:{api:{site_id:"633"}}}).react&&(o.push_state=new FunctionListener({executor:()=>{const e=history.pushState;history.pushState=(t,n,i)=>{e.apply(history,[t,n,i]),updateListenersPotions(i)}}}),o.replace_state=new FunctionListener({executor:()=>{const e=history.replaceState;history.replaceState=(t,n,i)=>{e.apply(history,[t,n,i]),updateListenersPotions(i)}}}));const r={...s,...o};function insertHTML(e,t){const n=document.createElement("div");n.innerHTML=t;const i=document.querySelector(e);i&&i.parentNode?.insertBefore(n,i)}function getNode(e){return new Promise((t=>{const n=document.querySelector(e);if(n)t(n);else{const n=new MutationObserver((()=>{const i=document.querySelector(e);i&&(t(i),n.disconnect())}));n.observe(document.body,{childList:!0,subtree:!0})}}))}function uuidv4(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)))}function getDomain(){return location.hostname.replace(new RegExp("\\.","g"),"")}function parseQueryString(e=location.search){if(""===e)return{};const t={};return e.split("&").forEach((e=>{const[n,i]=e.split("=");t[n]=i})),t}function stringifyQueryString(e){return Object.entries(e).map((([e,t])=>`${e}=${t}`)).join("&")}function formatDate(e){let t=new Date;return e&&(t=new Date(e)),`${t.getFullYear()}-${t.toLocaleDateString("en",{month:"2-digit"})}-${t.toLocaleDateString("en",{day:"2-digit"})}`}function descendingInJson(e,t){let n=e;return t.split(".").forEach((e=>{n&&(n=n[e])})),n}function formatPrice(e){return isNaN(parseFloat(e))?"":e?parseFloat(e)?.toFixed(2).toString().replace(".",","):e}function parseStringToNumber(e){try{if(!e||"string"!=typeof e)return e;const t=e.replace(/[^0-9|,|.]/g,"").replace(",",".");return parseFloat(t)}catch(t){return window.potions.logger.captureError(t,!1),e}}function isPotionsProductObject(e){return e&&e.id&&e.link&&e.img_link}function getAnalyticsInfos(){return{}}const a={dom:{...t},utils:{...n},analytics:{...i}};class ObjectArray extends Array{push(e){if(!this[e.name])return this.createGetter(e),Array.prototype.push.apply(this,arguments)}createGetter(e){Object.defineProperty(this,e.name,{get:()=>e})}}class Logger{constructor(e,t){this._env=e,this.errors=[],this.logs=[]}captureError(e,t=!0){"production"===this._env||console.error(e),this.errors.push(e)}captureLog(e){"production"!==this._env&&console.log(...e),this.logs.push(e)}}class Analytics{constructor(e){this.global=e}sendEvent(e){try{const{attributes:t,options:n}=this.build(e);t&&this.send(t,n)}catch(e){window.potions.logger.captureError(e)}}build(e){return{attributes:{},options:{}}}async send(e,t){}}function GAAnalytics(e){return class extends e{sendGa(e,t={non_interactive:!1,custom_dimension:!1},n=0){if(("function"!=typeof window.ga.getAll||0===window.ga.getAll().length)&&n<10)setTimeout((()=>{this.sendGa(e,t,n+1)}),500);else{const n=window.ga.getAll().find((e=>(e.model.data.ea?.[":trackingId"]||e.model.data.ia?.[":trackingId"])===this.global.ua));n?(t.custom_dimension&&this.global.custom_dimension&&n.set(this.global.custom_dimension,e.event_label),n.send("event",e.event_category,e.event_action,e.event_label,1,{nonInteraction:t.non_interactive?1:0}),window.potions.logger.captureLog(["ANALYTICS - send with ga",e.event_category,"\n",e.event_action,"\n",e.event_label.replace("|","\n").replace(new RegExp(",","g"),"\n")])):window.potions.logger.captureError("ANALYTICS - NO UA SET",!1)}if(n>10)throw new Error("Analytics blocks")}sendGtag(e,t=!1,n=0){try{"function"!=typeof window.gtag&&n<10?setTimeout((()=>{this.sendGtag(e,t,n+1)}),500):(window.gtag("event",e.value,{...e.data,non_interaction:t}),window.potions.logger.captureLog(["GA - send with gtag","\n",e.value,"\n",e.data]))}catch(e){window.potions.logger.captureError(e,!1)}}}}class GA4nalytics extends(GAAnalytics(Analytics)){constructor(e){super(e),"potions_gtag"===this.global.sender&&this.addGtagTag()}getExperienceIdFromNameAndPlacement(e,t){const n={sentry:!1,analytics:[],multiply:{api:{site_id:"633"}}}[e][t]?.experience_id??{sentry:!1,analytics:[],multiply:{api:{site_id:"633"}}}[e]?.configs?.[t]?.algorithm?.experience_id;return"string"==typeof n?n:{sentry:!1,analytics:[],multiply:{api:{site_id:"633"}}}[e][t]?.experience_id[window.potions.actions.getLang()]??{sentry:!1,analytics:[],multiply:{api:{site_id:"633"}}}[e]?.configs?.[t]?.algorithm?.experience_id[window.potions.actions.getLang()]}build(e){let t=null;return e.widget.match("(ab_experiment)")?{attributes:{value:"potions_ab",data:{event_type:"ab",experience_type:`${e.widget}_${e.id}`,experience_name:e.options?.label,action_type:e.action}}}:(t={event_type:"op",experience_type:e.widget,experience_id:this.getExperienceIdFromNameAndPlacement(e.widget,e.options.label),experience_name:e.options?.label,action_type:e.action,action_name:e.id},e.options?.items?(t.potions_items=JSON.stringify(e.options?.items?.map((e=>e.id))),{attributes:{value:"potions_items",data:t}}):{attributes:{value:"potions_no_items",data:t}})}addGtagTag(){const e=document.createElement("script");e.setAttribute("async","true"),e.setAttribute("src",`https://www.googletagmanager.com/gtag/js?id=${this.global.id}`);const t=document.createElement("script");t.innerHTML=`\n      window.dataLayer = window.dataLayer || [];\n      function gtag(){dataLayer.push(arguments);}\n      gtag('js', new Date());\n      gtag("config", "${this.global.id}");\n      `,document.head.append(e),document.head.append(t)}async send(e){"tag_manager"===this.global.sender?(window.dataLayer.push({potions:void 0}),window.dataLayer.push({event:e.value,potions:e.data}),window.potions.logger.captureLog(["GA4 - push in dataLayer",{event:e.value,potions:e.data},JSON.stringify(e.data)])):(e.value="potions",this.sendGtag(e))}}const c={propulse:{show:{button:{description:"Déclenchement de l'affichage du propulse (dans layer)"}},interact:{expand:{description:"Ouvrir le player (chatbot)"},click_powered:{description:"Cliquer sur le bouton powered by potions"}},convert:{redirect:{description:"Cliquer sur le bouton de redirection"}},end:{fold:{description:"Réduire le player (chatbot)"},cross:{description:"Fermer le bouton (button - bandeau)"}}},multiply:{show:{banner:{description:"Afficher popin de recommandation"}},interact:{continue_shopping:{description:"Fermer product en cliquant sur continuer les achats"},go_to_cart:{description:"Cliquer pour être redirigé sur le panier"},scroll_right:{description:"Cliquer sur la flèche de droite du carouselle"},scroll_left:{description:"Cliquer sur la flèche de gauche du carouselle"}},convert:{go_to_page:{description:"Cliquer sur un produit recommandé"},add:{description:"Ajouter un produit recommandé au panier"}},end:{close:{description:"Fermer product"}},stats:{not_available:{description:"Ajouter un produit recommandé non disponible au panier"}}},connect:{convert:{login:{description:"L'utilisateur a été loggué par potions"}},stats:{user_already_connected:{description:"L'utilisateur est déjà connecté."},not_supported:{description:"Le navigateur ne supporte pas auto login (autre que Chrome)"},no_password_saved_or_refused:{description:"Aucunes crédentials ne sont sauvegardées"}}},switch:{show:{banner:{description:"Le coupon est affiché à l'écran"}},convert:{activation:{description:"Cliquer sur le bouton pour activer le coupon"},fill_cart:{description:"Le coupon est rempli dans la page panier"},go_to_page:{description:"Cliquer sur un lien de redirection"}},end:{close:{description:"Le coupon est fermé"}},interact:{go_to_cart:{description:"Cliquer pour être redirigé sur le panier"},continue_shopping:{description:"Fermer switch en cliquant sur continuer les achats"}}},flashback:{show:{banner:{description:"Le flashback est affiché à l'écran"}},interact:{delete_product:{description:"Supprimer un produit du flashback"},pin_product:{description:""},remove_pin_product:{description:""},add_to_compare:{description:""}},convert:{go_to_page:{description:"Cliquer sur un produit du flashback"},add:{description:"Ajouter un produit au panier"}},end:{close:{description:"Le flashback est fermé"}}},wishlist:{show:{banner:{description:"La wishlist est affiché à l'écran"}},interact:{add:{description:"Ajouter un produit à la wishlist"},remove:{description:"Supprimer un produit de la wishlist"}},convert:{go_to_page:{description:"Cliquer sur un produit de la wishlist"},add:{description:"Ajouter un produit au panier"}},end:{close:{description:"La wishlist est fermée"}}},cart_recorder:{convert:{restore:{description:"Reconstruction du panier"}},interact:{no_availability:{description:"Pas de dispo"}}}};function buildEventsObject(e,t=!1,n=!1){try{const i=`${e.p}_${e.t}`,s=e.l?`${e.a}_${e.id}_${e.l}`:`${e.a}_${e.id}`,o=function reduce(e){const t=Object.entries(e.attributes).filter((([e,t])=>void 0!==t)).map((([e,t])=>("string"!=typeof t&&Array.isArray(t)&&(t=t.join(";")),[e,t]))).map((([e,t])=>`${e}=${t}`)).join(",");return`${e.key}|${t}`}({key:`${e.p}_${e.a}_${e.id}`,attributes:{...e,d:(new Date).toISOString()}});return{attributes:{event_category:i,event_action:s,event_label:o},options:{non_interactive:t,custom_dimension:n}}}catch(e){return window.potions.logger.captureError(e,!1),{}}}class GAUAAnalytics extends(GAAnalytics(Analytics)){build(e){let t;if("ab_experiment"===e.widget)t="ab";else if(t="op",!c[e.widget]?.[e.action]?.[e.id])throw new Error("Analytics event doesn't exist");return buildEventsObject({p:e.widget,t,a:e.action,id:e.id,l:e.options?.label||void 0,sku:e.options?.sku||void 0,price:e.options?.price||void 0,r:e.options?.items?.map((e=>e.id))||void 0},e.non_interactive??!1,"ab"===t?e.customDimension:void 0)}async send(e,t,n=0){try{if("ga"===this.global.sender&&window.ga||window.ga&&!this.global.sender?this.sendGa(e,t):"gtag"===this.global.sender&&window.gtag||window.gtag&&!this.global.sender?this.sendGtag({value:e.event_action,data:{event_category:e.event_category,event_label:e.event_label}},t.non_interactive):n<10&&setTimeout((()=>{this.send(e,t,n+1)}),500),n>10)throw new Error("Analytics blocks")}catch(e){window.potions.logger.captureError(e,!1)}}}const d={ua:GAUAAnalytics,ga4:GA4nalytics,at_internet:class AtInternetAnalytics extends Analytics{build(e){switch(e.action){case"show":return{attributes:{value:"self_promotion.display",data:{onsitead_type:`potions_${e.widget}`,onsitead_creation:e.widget,onsitead_general_placement:`potions_${e.widget}_${e.options?.label}`,onsitead_advertiser:"potions",...window.potions.actions.analytics.getAnalyticsInfos()}}};case"convert":return{attributes:{value:"self_promotion.click",data:{onsitead_type:`potions_${e.widget}`,onsitead_creation:e.widget,onsitead_general_placement:`potions_${e.widget}_${e.options?.label}`,onsitead_advertiser:"potions",click:`potions_${e.widget}_${e.options?.label}_${e.id}`,product:{placement:`potions_${e.widget}_${e.options?.label}`,...this.transformProduct(e.options?.items?.[0])},...window.potions.actions.analytics.getAnalyticsInfos()}}};default:return{attributes:{value:"click.exit",data:{click:`potions_${e.widget}_${e.options?.label}_${e.id}`,...window.potions.actions.analytics.getAnalyticsInfos()}}}}return{}}transformProduct(e){try{return e?{id:`${e.id}`,name:e.title,price:parseStringToNumber(e.price.toString())}:{}}catch(e){return window.potions.logger.captureError(e,!1),{}}}async send(e,t,n=0){try{const i=descendingInJson(window,this.global.sender_path);if(i&&i[this.global.sender_function]?this.sendATInternet(e,i):n<10&&setTimeout((()=>{this.send(e,t,n+1)}),500),n>=10)throw new Error("Analytics blocks")}catch(e){window.potions.logger.captureError(e,!1)}}async sendATInternet(e,t){t[this.global.sender_function](e.value,e.data),window.potions.logger.captureLog(["AT INTERNET - send event",e.value,e.data])}},matomo:class MatomoAnalytics extends Analytics{build(e){let t;if("ab_experiment"===e.widget)t="ab";else if(t="op",!c[e.widget]?.[e.action]?.[e.id])throw new Error("Analytics event doesn't exist");return buildEventsObject({p:e.widget,t,a:e.action,id:e.id,l:e.options?.label||void 0,sku:e.options?.sku||void 0,price:e.options?.price||void 0})}async send(e,t,n=0){try{let t=window._paq;if(this.global.sender&&(t=window[this.global.sender]),t&&(t.push(["trackEvent",e.event_category,e.event_action,e.event_label]),window.potions.logger.captureLog(["MATOMO - send event","\n",e.event_category,"\n",e.event_action,"\n",e.event_label.replaceAll("|","\n").replaceAll(",","\n")])),n>10)throw new Error("Analytics blocks")}catch(e){window.potions.logger.captureError(e,!1)}}},content_square:class ContentSquareAnalytics extends Analytics{build(e){return"show"===e.action?{attributes:{key:`PO_DISPLAY_${e.widget}`,value:e.options.label}}:"ab_experiment"===e.widget?"execute"===e.action?{attributes:{key:`PO_AB_EXECUTE_${e.id}`,value:e.options.label}}:{attributes:{key:`PO_AB_SET_BUCKET_${e.id}`,value:e.options.label}}:{}}async send(e,t,n=0){try{let i=window._uxa;if(this.global.sender&&(i=window[this.global.sender]),i?.push?(i.push(["trackDynamicVariable",{key:e.key,value:e.value}]),window.potions.logger.captureLog(["CONTENT SQUARE - send event",e.key,e.value])):n<10&&setTimeout((()=>{this.send(e,t,n+1)}),500),n>=10)throw new Error("Analytics content square blocks")}catch(e){window.potions.logger.captureError(e,!1)}}},piwik:class PiwikAnalytics extends Analytics{build(e){let t;if("ab_experiment"===e.widget)t="ab";else if(t="op",!c[e.widget]?.[e.action]?.[e.id])throw new Error("Analytics event doesn't exist");return buildEventsObject({p:e.widget,t,a:e.action,id:e.id,l:e.options?.label||void 0,sku:e.options?.sku||void 0,price:e.options?.price||void 0})}async send(e,t,n=0){try{let t=window._paq;if(this.global.sender&&(t=window[this.global.sender]),t&&(t.push(["trackEvent",e.event_category,e.event_action,e.event_label]),window.potions.logger.captureLog(["PIWIK - send event","\n",e.event_category,"\n",e.event_action,"\n",e.event_label.replaceAll("|","\n").replaceAll(",","\n")])),n>10)throw new Error("Analytics blocks")}catch(e){window.potions.logger.captureError(e,!1)}}}},u=[]?.map((e=>new(0,d[e.type])(e)));class analytics_Analytics{sendEvent(e){u.forEach((t=>t.sendEvent(e)))}}const l={add_geo_loc:new Process((async(e,t)=>{if(1===t.nbPageInSession){const e=await fetch("https://geoip.get-potions.com/"),n=await e.json(),i=await window.potions.widgets.navigation_recorder.storage.db.get("sessions",t.sessionId);window.potions.widgets.navigation_recorder.storage.db.update("sessions",{...i,geo_loc:n}),t.geoLoc=n}}),"pageId")},p={};({sentry:!1,analytics:[],multiply:{api:{site_id:"633"}}}).processes&&[...{sentry:!1,analytics:[],multiply:{api:{site_id:"633"}}}.processes].forEach((e=>{l[e]&&(p[e]=l[e])}));class Potions{constructor({env:e},t){this.version="14.4.1",this.state=new State,this.actions=a,this.listeners=r,this.initializers={},this.widgets=new ObjectArray,this.analytics=new analytics_Analytics,this.data={},this.temp={rules:{}},this.logger=new Logger(e,t)}async launch(){try{await this.launchInitializers(),this.launchElements(),this.launchProcesses(),this.launchListeners()}catch(e){this.logger.captureError(e)}}async launchInitializers(){for(const e of Object.values(this.initializers))await e.launch(this.state)}launchElements(){let e=[];this.widgets.forEach((t=>{e=[...new Set([...e,...t.elements])]})),e.forEach((e=>{e.define()}))}launchProcesses(){this.widgets.forEach((e=>{Object.values(e.processes).forEach((e=>{e.launch(this.state)}))})),Object.values(p).forEach((e=>{e.launch(this.state)}))}launchListeners(){this.widgets.forEach((e=>{Object.values(e.listeners).forEach((e=>{e.launch(this.state)}))})),Object.values(this.listeners).forEach((e=>{e.launch(this.state)}))}}const g={async radio(e){const t={url:location.href,id:e.detail.native_event.target.id,name:e.detail.native_event.target.name,type:e.detail.native_event.target.type,value:e.detail.native_event.srcElement.value,page_id:window.potions.state.pageId,timestamp:Date.now()};return[await window.potions.widgets.navigation_recorder.getSaveFormByName(e.detail.native_event.target.name),t]},async checkbox(e){const t={url:location.href,id:e.detail.native_event.target.id,name:e.detail.native_event.target.name,type:e.detail.native_event.target.type,value:e.detail.native_event.srcElement.checked,page_id:window.potions.state.pageId,timestamp:Date.now()};return[await window.potions.widgets.navigation_recorder.getSaveFormById(e.detail.native_event.target.id),t]},async password(e){const t={url:location.href,type:"password",id:e.detail.native_event.srcElement.id,value:"",page_id:window.potions.state.pageId,timestamp:Date.now()};return[await window.potions.widgets.navigation_recorder.getSaveFormById(e.detail.native_event.srcElement.id),t]},select2:async e=>[await window.potions.widgets.navigation_recorder.getSaveFormById(e.detail.id),{id:e.detail.id,type:"select2",value:e.detail.native_event.id,url:location.href,page_id:window.potions.state.pageId,timestamp:Date.now()}],async default(e){const t={url:location.href,id:e.detail.native_event.target.id,name:e.detail.native_event.target.name,type:e.detail.native_event.target.type,value:e.detail.native_event.srcElement.value,page_id:window.potions.state.pageId,timestamp:Date.now()};return[await window.potions.widgets.navigation_recorder.getSaveFormById(e.detail.native_event.target.id),t]}},h=[{name:"visited_urls",options:{autoIncrement:!0,keyPath:"id"},indexes:["session_id"]},{name:"forms",options:{autoIncrement:!0,keyPath:"form_id"},indexes:["id","page_id"]},{name:"user",options:{}},{name:"sessions",options:{autoIncrement:!0,keyPath:"id"},indexes:[]}];class NavigationRecorder extends Widget{constructor(e,t){super(e,t),this._storage.db=new DBWrapper("potions_nav_recorder",1,h),this._actions.record=g,this._processes.url_change=new Process((e=>{this.savePageview(e.detail?.url)}),"potions_url_change"),this._processes.input_change=new Process((e=>{this.saveForm(e.detail?.native_event?.target?.type,e)}),"potions_input_change"),this._processes.custom_input_change=new Process((e=>{this.saveForm(e.detail?.name,e)}),"potions_input_custom_change")}async savePageview(e){const t=await this.getSessionId(),n=await this._storage.db.add("visited_urls",{url:e,session_id:this._potions.state.sessionId,arrival_timestamp:Date.now(),departure_timestamp:void 0,timestamp:Date.now()});this._potions.state.setPageId(n,this._potions),this._storage.db.update("sessions",{...t,end:Date.now()})}async getSessionId(){const e=(await this._storage.db.getAll("sessions")).pop();if(e&&!NavigationRecorder.isSessionEnded(e))return this._potions.state.setSessionId(e.id),e;{const e={begin:Date.now(),end:Date.now()},t=await this._storage.db.add("sessions",e);return this._potions.state.setSessionId(t),{...e,id:t}}}static isSessionEnded(e){const t=(new Date).getTime(),n=new Date(t-18e5).getTime();return e&&e.end<n}async saveForm(e,t){try{let n,i;this._actions.record[e]?[n,i]=await this._actions.record[e].apply(this,[t]):[n,i]=await this._actions.record.default.apply(this,[t]),i&&this.saveFormInDb(n,i)}catch(e){this._potions.logger.captureError(e,!1)}}async saveFormInDb(e,t){if(e){const n=t;n.form_id=e.value.form_id,await this._storage.db.update("forms",n)}else await this._storage.db.add("forms",t)}async getSavedForms(){return this._storage.db.query("forms",{equal:this._potions.state.pageId},"page_id")}async getSaveFormByName(e){return(await this.getSavedForms()).reverse().find((t=>t.value.name===e))}async getSaveFormById(e){return(await this.getSavedForms()).reverse().find((t=>t.value.id===e))}}const _={relative_time:function relativeTime(e){return Date.now()-parseFloat(e)},get_in_storage:async function get(e,t,n){const i=await(window.potions.widgets[e]?.storage?.db?.get(t[0],t[1]));if(i)return n?i[n]:i},get_all_in_storage:async function getAll(e,t){return await window.potions.widgets[e].storage.db.getAll(t)},rule:function rule(e){return e.apply(this,this.execution_id)},fetch_on_same_url:async function fetchUrl(e){if(!e||e.includes("undefined"))return!1;try{return(await fetch(e)).url===e}catch(e){return window.potions.logger.captureError(e,!1),!1}},to_array:function toArray(e){return Array.isArray(e)?e:[e]}};const w={"!":function not(e){return!e},"===":function equal(e,t){return e===t},"!==":function different(e,t){return e!==t},"&&":function and(...e){for(const t of e)if(!t)return!!t;return!0},"||":function or(...e){for(const t of e)if(t)return!!t;return!1},if:function ifelse(...e){return e[0]?e[1]:e[2]},index_of:function indexOf(e,t){return!(!e||!t)&&e.includes(t)},is_undefined:function isUndefined(e){return null==e},is_null:function isNull(e){return null===e},match:function match(e,t){return e?.match(new RegExp(t))}};const m={join:function join(...e){return e.join("")},concat:function concat(e,t){return e.concat(t)},length:function array_length(e){return e?e.length:0},map_by_key:function mapByKey(e,t){return e.map((e=>e[t]))},map:function map(e,t){return e?.map(t)},filter:async function filter(e,t){const n=[];if(!(Symbol.iterator in Object(e)))return n;for(const i of e)await t.apply({...this,filter_value:i})&&n.push(i);return n},contains:function contains(e,t){let n=!1;for(const i of t)e&&e.includes(i)&&(n=!0);return n},first:function first(e){return e?.[0]},last:function last(e){return Array.isArray(e)?e[e.length-1]:e},pop:function pop(e){return e?.pop()},random:function random(e){return e.sort((()=>Math.random()-.5))},includes:function includes(e,t){return!!e&&e.includes(t)},set:function set(e){return[...new Set(e)]},merge:function merge(e,t){return{...e,...t}},is_in_array_not_strict:function inArrayNotStrict(e,t){window.potions.logger.captureLog(["WARNING : rule is_in_array_not_strict is deprecate"]);let n=!1;for(const i of t)e&&e.includes(i)&&(n=!0);return n},is_in_array_strict:function inArrayStrict(e,t){window.potions.logger.captureLog(["WARNING : rule is_in_array_strict is deprecate"]);let n=!1;if(void 0===t||t===[]||null===t)return!1;for(const i of t)i===e&&(n=!0);return n}};const y={all:function data_all(...e){return e},var:async function getVar(e,t){let n={...this,...t};if(void 0===e||""===e||null===e)return n;const i=String(e).split(".");for(const e of i)if(n=await n[e],null==n)return null;return n},build_object:function buildObject(...e){const t={};for(const n of e){const e=Object.entries(n);t[e[0][0]]=e[0][1],1===t[e[0][0]].length&&(t[e[0][0]]=t[e[0][0]][0])}return t},set_temp:function setTemp(e,t){this.window.potions.temp.rules[this.execution_id][e]=t},get_temp:function getTemp(e,t){let n=this.window.potions.temp.rules[this.execution_id][e];return n&&t&&String(t).split(".").forEach((e=>{n=n[e]})),n},then:function then(...e){return e[e.length-1]},execute:async function execute(e,...t){return e(...t)},action:async function action(e,t,...n){return e[t](...n)},prop:function prop(e,t){return e?.[t]},build_date:function buildDate(e){return new Date(e)},typeof:function typeOf(e){return typeof e}};const v={...y,...w,...{">":function sup(e,t){return e>t},"<":function inf(e,t){return e<t},">=":function suppEqual(e,t){return e>=t},"<=":function infEqual(e,t){return e<=t},"+":function add(...e){let t=0;for(const n of e)t+=parseFloat(n);return t},"*":function multiply(...e){let t=1;for(const n of e)t*=parseFloat(n);return t},"/":function devide(e,t){return parseFloat(e)/parseFloat(t)},"%":function modulo(e,t){return parseFloat(e)%parseFloat(t)}},...m,..._,...{selector:function selector(e,t){const n=document.querySelector(e);return n&&t?n[t]||n.getAttribute(t):n},selector_all:function selectorAll(e,t){const n=[...document.querySelectorAll(e)];return t?n.map((e=>e.getAttribute(t))):n},from_node_selector:function fromNodeSelector(e,t,n){const i=t.querySelector(e);return i&&n?i[n]||i.getAttribute(n):i},from_node_selector_all:function fromNodeSelectorAll(e,t,n){const i=[...t.querySelectorAll(e)];return n?i.map((e=>e[n]||e.getAttribute(n))):i},get_style:function getStyle(e,t){try{return getComputedStyle(e)[t]}catch(e){return""}}},...{split:function split(e,t,n){const i=e.split(t);return n?i[n]:i},replace:function replace(e,t,n){return e&&"string"==typeof e?e.replace(t,n):e},string_to_number:function stringToNumber(e){return parseStringToNumber(e)},to_string:function string_toString(e){return e.toString()}}};class Rule{constructor(e,t){this._operationKey=e,this._operationArguments=Array.isArray(t)?t:[t]}async apply(e={},t){const n=t??uuidv4(),i={...e,window};return t||(window.potions.temp.rules[n]={}),"then"===this._operationKey?this.applyThen(i,n):"if"===this._operationKey?this.applyIf(i,n):this.applyClassical(i,n)}async applyThen(e,t){const n=[];for(const i of this._operationArguments)Rule.isRule(i)?n.push(await i.apply(e,t)):n.push(i);return this.executeOperation({...e,execution_id:t},n)}async applyClassical(e,t){const n=[];this._operationArguments.forEach((i=>{Rule.isRule(i)?n.push(i.apply(e,t)):n.push(i)}));const i=await Promise.all(n);return this.executeOperation({...e,execution_id:t},i)}async applyIf(e,t){const[n,i,s]=this._operationArguments;if(Rule.isRule(n)){const o=await n.apply(e,t);let r=i,a=s;return Rule.isRule(r)&&(r=o?await i.apply(e,t):void 0),Rule.isRule(a)&&(a=o?void 0:await s.apply(e,t)),this.executeOperation({...e,execution_id:t},[o,r,a])}throw new Error("If condition should be a rule")}executeOperation(e,t){if("function"==typeof v[this._operationKey])return v[this._operationKey].apply(e,t);const n={};return n[this._operationKey]=t,n}static isRule(e){return!!(e&&e._operationKey&&e._operationArguments&&e.apply)}static parse(e){if("object"!=typeof e)return e;if(Object.keys(e).length>1)return e;const[t]=Object.keys(e);if(!Array.isArray(e[t]))return e;const n=e[t].map((e=>Rule.parse(e)));return new Rule(t,n)}static async fromResource(e){const t={};return Object.entries(await e).forEach((([e,n])=>{t[e]=Rule.parse(n)})),t}}const f=[{name:"rules",file:"rules.json",type:Rule}];class PageEnricher extends Widget{constructor(e,t,n={}){super(e,t,f),this._potions.widgets.push(new NavigationRecorder(e,"navigation_recorder")),this._processes.enrich_page=new Process((()=>{this.enrichPage()}),["pageId","domLoaded"]),this.buildCustom(n)}async enrichPage(){try{const e=await this._resources.rules;if(e.enrich_object){const t=await e.enrich_object.apply();this._potions.logger.captureLog(["PAGE ENRICHER - enrich object",t]);const n=await this._potions.widgets.navigation_recorder.storage.db.get("visited_urls",this._potions.state.pageId);t&&(n.enrich=t,await this._potions.widgets.navigation_recorder.storage.db.update("visited_urls",n)),window.dispatchEvent(new CustomEvent("potions_enrich_page",{detail:{page:n}}))}}catch(e){this._potions.logger.captureError(e)}}}const b=[{name:"rules",file:"rules.json",type:Rule}],E=[{name:"cart",options:{keyPath:"id"}}];class CartRecorder extends Widget{constructor(e,t,n={}){super(e,t,b,n),this._storage.db=new DBWrapper("potions_cart_recorder",1,E),this._processes.add_cart=new Process((e=>{this.addCartLog(e)}),"potions_add_cart"),this._processes.sync_cart=new Process((e=>{this.syncCart(e)}),"potions_sync_cart"),this._processes.replace_cart=new Process((e=>{this.replaceCart(e)}),"potions_replace_cart"),this._processes.reset_logs=new Process((()=>{this._potions.widgets.cart_recorder.actions.resetCart()}),"domLoaded",{rules:this._resources.rules,rule_name:"should_reset_logs"}),this._actions.restoreCart=async()=>{const e=await this._storage.db.getAll("cart");for(const t of e)await this._actions.addProductToCart(t);this._potions.analytics.sendEvent({widget:"cart_recorder",action:"convert",id:"restore",non_interactive:!0})},this._actions.getSavedCart=async()=>this._storage.db.getAll("cart"),this._actions.addProductToCart=()=>{},this._actions.resetCart=()=>this.resetCart(),this._actions.getAllProducts=()=>this._storage.db.getAll("cart"),super.buildCustom(n)}async resetCart(){return this._storage.db.clear("cart")}async addCartLog(e){const t=await this._storage.db.get("cart",e.detail.product.id);t?(this._potions.logger.captureLog(["CART RECORDER - update quantity",e.detail.product]),await this._storage.db.update("cart",{...e.detail.product,quantity:parseInt(e.detail.product.quantity??"1",10)+parseInt(t.quantity??"1",10),timestamp:Date.now()})):(this._potions.logger.captureLog(["CART RECORDER - add product",e.detail.product]),await this._storage.db.add("cart",{quantity:1,...e.detail.product,timestamp:Date.now()}))}async replaceCart(e){await this._storage.db.clear("cart");const t=e.detail.cart;this._potions.logger.captureLog(["CART RECORDER - replace cart",t]),t.forEach((e=>{this._potions.logger.captureLog(["CART RECORDER - add element",e]),this._storage.db.add("cart",{...e,timestamp:Date.now()})}))}async syncCart(e){const t=await this._storage.db.getAll("cart"),n=e.detail.cart;this._potions.logger.captureLog(["CART RECORDER - sync cart",t,n]),t.forEach((e=>{const t=n.find((t=>t.id===e.id));t?parseInt(t.quantity,10)!==e.quantity&&(this._potions.logger.captureLog(["CART RECORDER - update element",e]),this._storage.db.update("cart",{...e,quantity:parseInt(t.quantity,10),timestamp:Date.now()})):(this._potions.logger.captureLog(["CART RECORDER - delete element",e]),this._storage.db.delete("cart",e.id))}))}}new Process((e=>{const t=document.createElement("potions-details-popup");t.setAttribute("product-id",e.detail.id),t.setAttribute("trigger",e.detail.trigger),t.setAttribute("root",""),Object.entries(e.detail.options??{}).forEach((([e,n])=>{t.setAttribute(e,n)})),document.body.append(t)}),"potions_multiply_open_details_popup");async function getViewedItems(e){let t=await window.potions.widgets.navigation_recorder.storage.db.getAll("visited_urls");e&&(t=t.filter((t=>t.session_id===e)));const n=t.map((e=>e?.enrich?.id)).filter((e=>e)).reverse();return Array.from(new Set(n))}const S=new Process((async e=>{const t=window.potions.actions.getSIBEmail();if(t){const n=await getViewedItems();n.length&&e.detail?.page?.enrich&&fetch("https://api.merch.get-potions.com/api/track/633/brevo/views",{headers:{"content-type":"application/json"},body:JSON.stringify({email:t,viewed_items:n}),method:"POST"}).then((e=>e.json())).then((e=>{e&&window.potions.logger.captureLog(["SIB - send viewed items",t,n])})).catch((e=>window.potions.logger.captureError(e)))}}),"potions_enrich_page");const A={listeners:{observe_dataLayer:new EventListener({event_name:"domLoaded",executor:()=>{const e=window.dataLayer.push;window.dataLayer.push=function(...t){const n=[].slice.call(t,0);return dispatchEvent(new CustomEvent("potions_update_datalayer",{detail:{args:n}})),e.apply(window.dataLayer,n)}}}),add_to_cart:new EventListener({event_name:"potions_update_datalayer",executor:async e=>{const t=e.detail.args?.[0];if("add_to_cart"===t?.event||"view_cart"===t?.event){const e=(t?.ecommerce?.cart??t?.ecommerce)?.products.map((e=>({id:e.id})));!function sendCartToSIB(e){const t=window.potions.actions.getSIBEmail();t&&fetch("https://api.merch.get-potions.com/api/track/633/brevo/cart",{headers:{"content-type":"application/json"},body:JSON.stringify({email:t,cart:e}),method:"POST"}).then((e=>e.json())).then((n=>{n&&window.potions.logger.captureLog(["SIB - send cart items",t,e])})).catch((e=>window.potions.logger.captureError(e)))}(e)}}})},actions:{getViewedItems,getIdFromUrl(e){if(e.includes(".html")){const t=e.split("/");return t[t.length-1].split("-")[0]}},resetCart(){window.potions.widgets.cart_recorder.resetCart(),function sendPurchaseToSIB(){const e=window.potions.actions.getSIBEmail();e&&fetch("https://api.merch.get-potions.com/api/track/633/brevo/purchase",{headers:{"content-type":"application/json"},body:JSON.stringify({email:e}),method:"POST"}).then((e=>e.json())).then((t=>{t&&window.potions.logger.captureLog(["SIB - send purchase - reset cart",e])})).catch((e=>window.potions.logger.captureError(e)))}(),window.potions.logger.captureLog(["CART RECORDER - reset cart"])}},"_potions.actions":{getSIBEmail:function getSIBEmail(){return window.sib?.email_id}},processes:{sendViewedItemsToSIB:S}};if(function isAsyncAvailable(){try{new Function("async () => {}")()}catch(e){return!1}return!0}()){if(sessionStorage.getItem("ptspreview")||location.search.includes("ptspreview")){let e=null;if(sessionStorage.getItem("ptspreview")?e=sessionStorage.getItem("ptspreview"):(e=location.search,sessionStorage.setItem("ptspreview",location.search)),!document.currentScript?.getAttribute("ptspreview")&&e){const t=Object.fromEntries(e.replace("?","").split("&").map((e=>e.split("=")))),n=document.createElement("script");throw n.setAttribute("ptspreview","true"),n.setAttribute("src",`https://preprod.client.get-potions.com/${t.ptspreview}/potions.js?${Date.now()}`),document.head.append(n),new Error("Loading preview version...")}}if(!window.potions){window.potions=new Potions({env:"production"});try{window.potions.widgets.push(new PageEnricher(window.potions,"page_enricher")),window.potions.widgets.push(new CartRecorder(window.potions,"cart_recorder",A)),window.potions.launch().then((()=>{window.potions.logger.captureLog(["CORE - launch potions done"])}))}catch(e){window.potions.logger.captureError(e)}}}})();